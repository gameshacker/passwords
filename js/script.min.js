function renderCategories(e){this._categories=e;var s=$("#template-categories").html(),a=Handlebars.compile(s),r=a({categories:this._categories.getAll()});$("#CategoriesTableContent").html(r),$("#new_category").html(""),$("#nav_category_list").html("");var o=document.getElementById("CategoriesTableContent");if(0==o.rows.length)$("#emptycategories").show(),$("#new_category").append("<p>("+t("passwords","No categories")+")</p><br>");else{$("#emptycategories").hide();var n="<select>";n+="<option value=0>("+t("passwords","None")+")</option>";for(var i=0;i<o.rows.length;i++){var d=o.rows[i].cells[1].textContent,l=o.rows[i].cells[3].textContent,c=o.rows[i].cells[4].textContent||"fff",p=getContrastYIQ(c);o.rows[i].cells[0].innerHTML='<div class="category" style="color:#'+p+";background-color:#"+c+';">'+l+"</div",n+="<option value="+d+" bg=#"+c+" fg="+p+">"+l+"</option>"}n+="<option value=(change)>("+t("passwords","Edit categories")+")</option>",n+="</select>",$("#new_category").append(n),$("#nav_category_list").html(n)}}function isNumeric(e){return!isNaN(parseFloat(e))&&isFinite(e)}function formatTable(e,s){var a=$("#app-settings").attr("active-table"),r="true"==$("#app-settings").attr("hide-usernames"),o="true"==$("#app-settings").attr("hide-passwords"),n="true"==$("#app-settings").attr("hide-attributes");if(!e){$("#PasswordsTableContent tbody").html(""),$("#ShareUsers").html("");for(var i=!1,d=!1,l=0;l<s.length-1;l++){var c=s[l].trim();c=c.replace(/\n/g,"\\n"),c=c.replace(/\t/g,"\\t"),c=c.replace(/\\/g,"\\\\"),c=c.replace(/\", ,/g,'",');try{var p=JSON.parse("{"+c+"}")}catch(u){try{c=escapeJSON(c);var p=JSON.parse("{"+c+"}")}catch(w){alert(u+" (row "+l+"):\n{"+c+"}");continue}}if(0!=p.id){if(i=p.user_id!=$("head").attr("data-user")?!0:!1,1==p.deleted)if(i)var h='<tr class="is_deleted is_sharedby" sharedby="'+p.user_id+'" ';else var h='<tr class="is_deleted" ';else if(i)var h='<tr class="is_sharedby" sharedby="'+p.user_id+'" ';else var h="<tr ";if("0000-00-00"==p.datechanged&&(p.datechanged="1970-01-01"),"undefined"==typeof p.strength&&(p.strength=-1),"undefined"!=typeof p.sharedwith&&""!=p.sharedwith?(d=!0,h+='attr_sharedwith="'+p.sharedwith+'" '):d=!1,h+='attr_id="'+p.id+'" attr_website="'+p.website+'" attr_address="'+p.address+'" attr_loginname="'+p.loginname+'" attr_pass="'+p.pass+'" attr_category="'+(p.category||"0")+'" attr_notes="'+p.notes.replace(/\\n/g,"\n").replace(/\\t/g,"	")+'" attr_datechanged="'+p.datechanged+'" attr_strength="'+strength_int2str(p.strength)+'" attr_length="'+p.length+'" attr_lower="'+p.lower+'" attr_upper="'+p.upper+'" attr_number="'+p.number+'" attr_special="'+p.special+'">',isUrl(p.website)||""!=p.address){h+='<td type="website" sorttable_customkey='+p.website+' class="is_website cell_website">';var _="true"==$("#app-settings").attr("icons-show");if(""!=p.address)if("http://"==p.address.substr(0,7)||"https://"==p.address.substr(0,8))var g=p.address;else var g="http://"+p.address;else var g="http://"+p.website;if(_){var v=$("#app-settings").attr("icons-service");"ddg"==v&&(h+='<a href="'+g+'" target="_blank"><img class="websitepic" src="https://icons.duckduckgo.com/ip2/'+URLtoDomain(g)+'.ico">'+p.website+"</a>"),"ggl"==v&&(h+='<a href="'+g+'" target="_blank"><img class="websitepic" src="https://www.google.com/s2/favicons?domain='+URLtoDomain(g)+'">'+p.website+"</a>")}else h+='<a href="'+g+'" target="_blank">'+p.website+"</a>"}else h+='<td type="website" sorttable_customkey='+p.website+' class="cell_website">'+p.website;if(h+=p.website.length>45?'<div class="btn_commands_newline"><input class="btn_commands_open" type="button"></div></td>':'<div class="btn_commands_inline"><input class="btn_commands_open" type="button"></div></td>',h+=r?'<td type="loginname" sorttable_customkey='+escapeHTML(p.loginname,!1)+' class="hidden_value">******<div class="btn_commands_inline"><input class="btn_commands_open" type="button"></div></td>':'<td type="loginname" sorttable_customkey='+escapeHTML(p.loginname,!1)+' class="cell_username"><div class="btn_commands_inline"><input class="btn_commands_open" type="button"></div>'+escapeHTML(p.loginname,!0)+"</td>",h+="oc_passwords_invalid_sharekey"==p.pass?'<td class="cell_password"><input id="btn_invalid_sharekey" type="button" value="'+t("passwords","Invalid share key")+'"></td>':o?'<td type="pass" sorttable_customkey='+escapeHTML(p.pass,!1)+' class="hidden_value">******<div class="btn_commands_inline"><input class="btn_commands_open" type="button"></div></td>':'<td type="pass" sorttable_customkey='+escapeHTML(p.pass,!1)+' class="cell_password"><div class="btn_commands_inline"><input class="btn_commands_open" type="button"></div>'+escapeHTML(p.pass,!0)+"</td>",n)$("#column_strength").hide(),$("#column_datechanged").hide();else{h+="<td sorttable_customkey="+1/p.strength+' class="'+strength_int2class(p.strength)+' cell_strength">'+strength_int2str(p.strength)+'<div class="btn_commands_inline">('+p.strength+")</div></td>";var m=new Date(p.datechanged);h+="<td sorttable_customkey="+date2sortkey(m)+' class="'+date2class(m)+' cell_datechanged"><span>'+date2str(m,!0)+'</span><div class="btn_commands_inline dateChanged">'+date2str(m,!1)+"</div></td>"}if(i)h+="<td></td>";else{var f=!1;p.category&&0!=p.category?(""==$("#CategoriesTableContent").html()&&setTimeout(function(){},1e3),$("#CategoriesTableContent tr").each(function(){var e=$(this).find(".catTable_id").text();if(e==p.category){var t=$(this).find(".catTable_bg").text(),s=getContrastYIQ(t),a=$(this).find(".catTable_name").text();h+='<td class="cell_category"><div class="category" style="color:#'+s+";background-color:#"+t+';">'+a+"</div></td>",f=!0}}),f||(h+='<td class="icon-category cell_category"></td>')):h+='<td class="icon-category cell_category"></td>'}h+=p.notes?'<td class="icon-notes has-note"></td>':'<td class="icon-notes"></td>',h+=1==p.deleted?'<td class="icon-history"></td>':'<td class="icon-info"></td>',h+=i?'<td class="icon-shared" title="'+t("passwords","Shared by %s").replace("%s",p.user_id)+'"><div class="sharedto_count"><span>0</span></div></td>':"yes"==$("#app-settings").attr("sharing-allowed")?d?'<td class="icon-public" title="'+t("passwords","Shared to %s").replace("%s",p.sharedwith)+'"><div class="sharedto_count is_sharedto"><span>'+p.sharedwith.split(",").length+"</span></div></td>":'<td class="icon-share"><div class="sharedto_count"><span>0</span></div></td>':"<td></td>",h+=i?"<td></td>":'<td class="icon-delete"></td>',h+="</tr>",$("#PasswordsTableContent tbody").append(h)}else{var b=p.website,C=b.replace(/[^a-zA-Z 0-9]+/g,""),y=p.user_id;$("#ShareUsersTableContent").append('<tr><td class="share_uid">'+b+'</td><td class="share_displayname">'+y+"</td></tr>"),y!=$("#expandDisplayName").text()&&(b!=y?$("#ShareUsers").append('<label><input type="checkbox" value='+b+'><div class="share_avatar avatar_'+C+'"></div><span><strong>'+y+"</strong> ("+b+")</span></label><br>"):$("#ShareUsers").append('<label><input type="checkbox" value='+b+'><div class="share_avatar avatar_'+C+'"></div><span>'+y+"</span></label><br>"),$(".avatar_"+C).avatar(b,32))}}}var k=$("#PasswordsTableContent tbody tr").length,S=$("#PasswordsTableContent tbody tr.is_deleted").length;$("#emptycontent").hide(),$("#emptytrashbin").hide(),$("#PasswordsTable").show(),$(".menu_passwords_active").text(k-S),$(".menu_passwords_trashbin").text(S),"active"==a&&k-S==0&&($("#emptycontent").show(),$("#PasswordsTable").hide()),"trashbin"==a&&0==S&&($("#delete_trashbin").hide(),$("#emptytrashbin").show(),$("#PasswordsTable").hide())}function strength_func(e){var t,s,a,r,o,n,i,d,l,c,p;switch(a=e.length,s=0,!0){case a>=8:break;case 4>=a:return 0}for(var u=1;a+1>u;u++)switch(t=e.slice(u,u+1),p=t.charCodeAt(0),!0){case p>=97&&122>=p:r||(s+=1,r=!0);break;case p>=65&&90>=p:o||(s+=1,o=!0);break;case p>=48&&57>=p:n||(s+=1,n=!0);break;case p>=33&&47>=p:i||(s+=1,i=!0);break;case p>=58&&64>=p:d||(s+=1,d=!0);break;case p>=91&&96>=p:l||(s+=1,l=!0);break;case p>=123&&255>=p:c||(s+=1,c=!0)}s+=Math.floor(a/8)*((r?1:0)+(o?1:0)+(n?1:0)+(i?1:0)+(d?1:0)+(l?1:0)+(c?1:0));var w=6;return s+=Math.round(Math.pow(a,w)/Math.pow(10,w+1))}function generatepw(e,t,s,a,r){for(var o,n,i=0,d=0;10>d;d++)o=generate(e,t,s,a,r),i<strength_func(o)&&(i=strength_func(o),n=o);return n}function generate(e,t,s,a,r){var o=Math.floor(r/(e+t+s+a)),n="",i="",d="",l="";e&&(n=random_characters(0,o)),t&&(i=random_characters(1,o)),s&&(d=random_characters(2,o)),a&&(l=random_characters(3,o));var c=""+n+i+d+l,p=r-o*(e+t+s+a);a?c+=random_characters(3,p):s?c+=random_characters(2,p):t?c+=random_characters(1,p):e&&(c+=random_characters(0,p));for(var u=c.split(""),w=u.length,h=w-1;h>0;h--){var _=Math.floor(Math.random()*(h+1)),g=u[h];u[h]=u[_],u[_]=g}return c=u.join("")}function random_characters(e,t){var s="",a="";switch(e){case 0:s="abcdefghijkmnpqrstuvwxyz";break;case 1:s="ACDEFGHJKLMNPQRSTUVWXYZ";break;case 2:s="2345679";break;case 3:s="!@#$%^&*()_+~[]{}:;?><,./-="}for(var r=0;t>r;r++)a+=s.charAt(Math.floor(Math.random()*s.length));return a}function uid2displayname(e){var t=e;return $("#ShareUsersTableContent tr").each(function(){var s=$(this).find(".share_uid").text(),a=$(this).find(".share_displayname").text();e==s&&(t=a)}),t}function strength_int2str(e){if(-1==e)return"???";switch(!0){case 8>e:return t("passwords","Weak");case 15>e:return t("passwords","Moderate");default:return t("passwords","Strong")}}function strength_int2class(e){if(-1==e)return!1;switch(!0){case 8>e:return"red";case 15>e:return"orange";default:return"green"}}function strength_str2class(e){switch(e){case t("passwords","Weak"):return"red";case t("passwords","Moderate"):return"orange";case t("passwords","Strong"):return"green"}}function bool2class_str(e){switch(parseInt(e)){case 0:return["red",t("passwords","No")];case 1:return["green",t("passwords","Yes")]}}function date2sortkey(e){return(e.getFullYear()+("0"+(e.getMonth()+1)).slice(-2)+("0"+e.getDate()).slice(-2))/1e7}function date2class(e){var t=new Date,s=Math.floor((t-e)/864e5),a=$("#app-settings").attr("days-orange"),r=$("#app-settings").attr("days-red");return s>r-1?"red":s>a-1?"orange":a>s?"green":void 0}function date2str(e,s){if(isNaN(e))return"???";var a=$("html").attr("lang");if(!s){var r,o,n=e.getMonth()+1;switch(n){case 1:o=t("passwords","January");break;case 2:o=t("passwords","February");break;case 3:o=t("passwords","March");break;case 4:o=t("passwords","April");break;case 5:o=t("passwords","May");break;case 6:o=t("passwords","June");break;case 7:o=t("passwords","July");break;case 8:o=t("passwords","August");break;case 9:o=t("passwords","September");break;case 10:o=t("passwords","October");break;case 11:o=t("passwords","November");break;case 12:o=t("passwords","December")}if("en"==a){var i;switch(e.getDate()){case 1:case 21:case 31:i="st";break;case 2:case 22:i="nd";break;case 3:case 23:i="rd";break;default:i="th"}r=e.getDate()+"<sup>"+i+"</sup> "+o+" "+e.getFullYear()}else r="nl"==a?e.getDate()+" "+o+" "+e.getFullYear():"de"==a?e.getDate()+". "+o+" "+e.getFullYear():"es"==a?e.getDate()+" de "+o+" de "+e.getFullYear():"ca"==a?"a"==o[0]||"o"==o[0]?e.getDate()+" d'"+o+" de "+e.getFullYear():e.getDate()+" de "+o+" de "+e.getFullYear():o+" "+e.getDate()+", "+e.getFullYear();return r}var d=new Date,l=Math.floor((d-e)/864e5);switch(l){case-1:case 0:return t("passwords","today");case 1:return"es"==a?"hace "+l+" "+t("passwords","day ago"):"ca"==a?"fa "+l+" "+t("passwords","day ago"):l+" "+t("passwords","day ago");default:return"es"==a?"hace "+l+" "+t("passwords","days ago"):"ca"==a?"fa "+l+" "+t("passwords","days ago"):l+" "+t("passwords","days ago")}}function strength_str(e,s){if(!s){if(""==e)return $("#generate_strength").text(""),!1;$("#generate_strength").removeClass("red"),$("#generate_strength").removeClass("orange"),$("#generate_strength").removeClass("green")}switch(strength_func(e)){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:if(s)return t("passwords","Weak");$("#generate_strength").text(t("passwords","Strength")+": "+t("passwords","Weak").toLowerCase()+" ("+strength_func(e)+")"),$("#generate_strength").addClass("red");break;case 8:case 9:case 10:case 11:case 12:case 13:case 14:if(s)return t("passwords","Moderate");$("#generate_strength").text(t("passwords","Strength")+": "+t("passwords","Moderate").toLowerCase()+" ("+strength_func(e)+")"),$("#generate_strength").addClass("orange");break;default:if(s)return t("passwords","Strong");$("#generate_strength").text(t("passwords","Strength")+": "+t("passwords","Strong").toLowerCase()+" ("+strength_func(e)+")"),$("#generate_strength").addClass("green")}$("#generate_strength_popup").text($("#generate_strength").text()),$("#generate_strength_popup").attr("class",$("#generate_strength").attr("class"))}function webimg2new(){if(isUrl($("#new_website").val())||""!=$("#new_address").val()){var e="true"==$("#app-settings").attr("icons-show");if(""!=$("#new_address").val())if("http://"==$("#new_address").val().substr(0,7)||"https://"==$("#new_address").val().substr(0,8))var t=$("#new_address").val();else var t="http://"+$("#new_address").val();else var t="http://"+$("#new_website").val();if(e){var s=$("#app-settings").attr("icons-service");$("#websiteimg").removeClass("icon-share"),"ddg"==s&&$("#websiteimg").attr("style","opacity: 1; background-image: url(https://icons.duckduckgo.com/ip2/"+URLtoDomain(t)+".ico);"),"ggl"==s&&$("#websiteimg").attr("style","opacity: 1; background-image: url(https://www.google.com/s2/favicons?domain="+URLtoDomain(t)+");")}}else $("#websiteimg").addClass("icon-share"),$("#websiteimg").attr("style","")}function escapeHTML(e,t){return"undefined"!=typeof e?t?e.replace(/</g,"&lt;").replace(/>/g,"&gt;"):e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):e}function escapeJSON(e){return e=e.replace(/", "/g,",uJ94dFpJv36usjxQS56SL3Lv77H25cE3 "),e=e.replace(/" : "/g," :uJ94dFpJv36usjxQS56SL3Lv77H25cE3 "),e=e.replace(/\": \"/g," :uJ94dFpJv36usjxQS56SL3Lv77H25cE3 "),e=e.substr(1),e=e.replace(/.$/g,""),e=$("<textarea/>").text(e).html(),e=e.replace(/\"/g,"&quot;"),e=e.replace(/,uJ94dFpJv36usjxQS56SL3Lv77H25cE3 /g,'", "'),e=e.replace(/ :uJ94dFpJv36usjxQS56SL3Lv77H25cE3 /g,'" : "'),e='"'+e+'"'}function isUrl(e){e=e.toLowerCase();var t="^[^\\s/$.?#]\\S{1,}\\.[a-z]{2,}$",s=new RegExp(t);return s.test(e)}function strip_website(e){var t=e;return isUrl(e)?("https://"==t.substr(0,8)&&(t=t.substr(8,t.length-8)),"http://"==t.substr(0,7)&&(t=t.substr(7,t.length-7)),"www."==t.substr(0,4)&&(t=t.substr(4,t.length-4)),t):e}function URLtoDomain(e){var t;return t=e.indexOf("://")>-1?e.split("/")[2]:e.split("/")[0],t=t.split(":")[0],"www."==t.substr(0,4)&&(t=t.substr(4,t.length-4)),t}function findRow(e){var t=$("tr").filter(function(){return $(this).attr("attr_id")==e});return t}function findHighestID(){var e=0;return $("tr").each(function(){e<parseInt($(this).attr("attr_id"))&&(e=parseInt($(this).attr("attr_id")))}),e}function findNewestRow(){return findRow(findHighestID())}function markRow(e){$(e).animate({backgroundColor:"#ffa"},400,function(){$(this).animate({backgroundColor:"none"},1500)})}function createRow(e){var s="true"==$("#app-settings").attr("hide-usernames"),a="true"==$("#app-settings").attr("hide-passwords"),r="true"==$("#app-settings").attr("hide-attributes"),o=e;o.id=findHighestID()+1;var n="<tr ",i=new Date,d=i.getFullYear()+"-"+("0"+(i.getMonth()+1)).slice(-2)+"-"+("0"+i.getDate()).slice(-2);if(o.datechanged=d,o.strength=strength_func(o.pass),n+='attr_id="'+o.id+'" attr_website="'+o.website+'" attr_address="'+o.address+'" attr_loginname="'+o.loginname+'" attr_pass="'+o.pass+'" attr_category="'+(o.category||"0")+'" attr_notes="'+o.notes.replace(/\\n/g,"\n").replace(/\\t/g,"	")+'" attr_datechanged="'+o.datechanged+'" attr_strength="'+strength_int2str(o.strength)+'" attr_length="'+o.pass.length+'" attr_lower="'+o.lower+'" attr_upper="'+o.upper+'" attr_number="'+o.number+'" attr_special="'+o.special+'">',isUrl(o.website)||""!=o.address){n+='<td type="website" sorttable_customkey='+o.website+' class="is_website cell_website">';var l="true"==$("#app-settings").attr("icons-show");if(""!=o.address)if("http://"==o.address.substr(0,7)||"https://"==o.address.substr(0,8))var c=o.address;else var c="http://"+o.address;else var c="http://"+o.website;if(l){var p=$("#app-settings").attr("icons-service");"ddg"==p&&(n+='<a href="'+c+'" target="_blank"><img class="websitepic" src="https://icons.duckduckgo.com/ip2/'+URLtoDomain(c)+'.ico">'+o.website+"</a>"),"ggl"==p&&(n+='<a href="'+c+'" target="_blank"><img class="websitepic" src="https://www.google.com/s2/favicons?domain='+URLtoDomain(c)+'">'+o.website+"</a>")}else n+='<a href="'+c+'" target="_blank">'+o.website+"</a>"}else n+='<td type="website" sorttable_customkey='+o.website+' class="cell_website">'+o.website;if(n+=o.website.length>45?'<div class="btn_commands_newline"><input class="btn_commands_open" type="button"></div></td>':'<div class="btn_commands_inline"><input class="btn_commands_open" type="button"></div></td>',n+=s?'<td type="loginname" sorttable_customkey='+escapeHTML(o.loginname,!1)+' class="hidden_value">******<div class="btn_commands_inline"><input class="btn_commands_open" type="button"></div></td>':'<td type="loginname" sorttable_customkey='+escapeHTML(o.loginname,!1)+' class="cell_username"><div class="btn_commands_inline"><input class="btn_commands_open" type="button"></div>'+escapeHTML(o.loginname,!0)+"</td>",n+="oc_passwords_invalid_sharekey"==o.pass?'<td class="cell_password"><input id="btn_invalid_sharekey" type="button" value="'+t("passwords","Invalid share key")+'"></td>':a?'<td type="pass" sorttable_customkey='+escapeHTML(o.pass,!1)+' class="hidden_value">******<div class="btn_commands_inline"><input class="btn_commands_open" type="button"></div></td>':'<td type="pass" sorttable_customkey='+escapeHTML(o.pass,!1)+' class="cell_password"><div class="btn_commands_inline"><input class="btn_commands_open" type="button"></div>'+escapeHTML(o.pass,!0)+"</td>",r)$("#column_strength").hide(),$("#column_datechanged").hide();else{n+="<td sorttable_customkey="+1/o.strength+' class="'+strength_int2class(o.strength)+' cell_strength">'+strength_int2str(o.strength)+'<div class="btn_commands_inline">('+o.strength+")</div></td>";var i=new Date(o.datechanged);n+="<td sorttable_customkey="+date2sortkey(i)+' class="'+date2class(i)+' cell_datechanged"><span>'+date2str(i,!0)+'</span><div class="btn_commands_inline dateChanged">'+date2str(i,!1)+"</div></td>"}n+='<td class="icon-category cell_category"></td>',n+=o.notes?'<td class="icon-notes has-note"></td>':'<td class="icon-notes"></td>',n+='<td class="icon-info"></td>',n+='<td class="icon-share"><div class="sharedto_count"><span>0</span></div></td>',n+='<td class="icon-delete"></td>',n+="</tr>",$("#PasswordsTableContent tbody").append(n),formatTable(!0)}function backupPasswords(){return-1!==navigator.userAgent.indexOf("MSIE")||navigator.appVersion.indexOf("Trident/")>0?(OCdialogs.alert(t("passwords","This function is unsupported on your browser. Use a modern browser instead."),t("passwords","Download Backup"),function(){return!1},!0),!1):void OCdialogs.confirm(t("passwords","This will download an unencrypted backup file, which contains all your passwords.")+" "+t("passwords","This file is fully compatible with other password services, such as KeePass, 1Password and LastPass.")+" "+t("passwords","Are you sure?"),t("passwords","Download Backup"),function(e){if(e){var s=new Date,a='"Website","Username","Password","FullAddress","Notes"\r\n',r=window.confirm(t("passwords","Would you like to backup deleted passwords too?"));$("#PasswordsTableContent tbody tr").each(function(){var e=$(this);(!e.hasClass("is_deleted")||r)&&(a+='"'+e.attr("attr_website").replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'","'+e.attr("attr_loginname").replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'","'+e.attr("attr_pass").replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'","'+e.attr("attr_address").replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'","'+e.attr("attr_notes").replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"\r\n')});var o=new Blob([a],{type:"text/plain"}),s=new Date,n=s.getFullYear()+("0"+(s.getMonth()+1)).slice(-2)+("0"+s.getDate()).slice(-2)+"_backup.csv",i=document.createElement("a");i.download=n,i.innerHTML="Download File",null!=window.webkitURL?i.href=window.webkitURL.createObjectURL(o):(i.href=window.URL.createObjectURL(o),i.onclick=destroyClickedElement,i.style.display="none",document.body.appendChild(i)),i.click(),i="",$("#app-settings-content").hide()}},!0)}function destroyClickedElement(e){document.body.removeChild(e.target)}function uploadCSV(e){if(!(window.File&&window.FileReader&&window.FileList&&window.Blob))return OCdialogs.alert(t("passwords","This function is unsupported on your browser. Use a modern browser instead."),t("passwords","Import CSV File"),function(){return!1},!0),!1;var s=e.target.files[0];if(!s)return OCdialogs.alert("No file loaded",t("passwords","Import CSV File"),function(){return!1},!0),$("#upload_csv").replaceWith($("#upload_csv").clone(!0).val("")),!1;if(".csv"!=s.name.substr(s.name.length-4,4).toLowerCase())return OCdialogs.alert(t("passwords","This is not a valid CSV file.")+" Only files with CSV as file extension are allowed.",t("passwords","Import CSV File"),function(){return!1},!0),$("#upload_csv").replaceWith($("#upload_csv").clone(!0).val("")),!1;var a=new FileReader;a.onload=function(e){var t=e.target.result;$("#CSVcontent").text(t),renderCSV(!0)},a.readAsText(s),$("#CSVtableDIV h2").text(t("passwords","Import CSV File")+": '"+s.name+"' (~"+Math.round(s.size/1024)+" kB)"),$("#CSVpreviewTitle").text(t("passwords","Preview")+":"),$("#upload_csv").replaceWith($("#upload_csv").clone(!0).val(""))}function renderCSV(e){$("#CSVtable").empty(),$("#CSVerrorfield").empty();var s=$("#CSVcontent").text();if(s=s.replace(/"\n/g,'""\n').replace(/"\r\n/g,'""\r\n'),$("#CSVsplit_rnBtn").hasClass("CSVbuttonOff"))var a=(s.match(/\n/g)||[]).length+1,r=s.split('"\n');else var a=(s.match(/\r\n/g)||[]).length+1,r=s.split('"\r\n');if($("#CSVheadersBtn").hasClass("CSVbuttonOff"))var o=0;else var o=1;if($("#CSVquotationmarksBtn").hasClass("CSVbuttonOff"))var n=!1,i=",";else var n=!0,i='","';if($("#CSVescapeslashBtn").hasClass("CSVbuttonOff"))var d=!1;else var d=!0;1>a&&InvalidCSV(t("passwords","This file contains no passwords."));for(var l=0,c=o;c<r.length;c++)if(""!=r[c]){n||'"'==r[c].substr(0,1)||InvalidCSV(t("passwords","This file contains one or more values without quotation marks."));var p=r[c].split(i);l<p.length&&(l=p.length),p.length<3&&InvalidCSV(t("passwords","This file contains one or more lines with less than 3 columns.")),n&&(r[c]=r[c].substr(1,r[c].trim().length-2))}else a-=1;var u=$("#CSVtable"),w="";for(w='<thead><tr><td id="CSVcolumnCheck">'+t("passwords","Import")+":</td>",c=1;l+1>c;c++)w=w+'<td id="CSVcolumnTD'+c+'"><select id="CSVcolumn'+c+'"><option value="website">'+t("passwords","Website or company")+'</option><option value="username">'+t("passwords","Login name")+'</option><option value="password">'+t("passwords","Password")+'</option><option value="url">'+t("passwords","Full URL")+'</option><option value="notes">'+t("passwords","Notes")+'</option><option value="empty" selected>('+t("passwords","Do not import")+")</option></select></td>";w+="</tr></thead>",0!=l&&u.append(w),$("#CSVcolumn1 option").eq(0).prop("selected",!0),$("#CSVcolumn2 option").eq(1).prop("selected",!0),$("#CSVcolumn3 option").eq(2).prop("selected",!0),$("#CSVcolumn4 option").eq(3).prop("selected",!0),$("#CSVcolumn5 option").eq(4).prop("selected",!0);var h="<tbody>";for(c=o;c<r.length;c++)if(""!=r[c]){var p=r[c].split(i);h=h+'<tr><td><input type="checkbox" id="CSVcheckRow'+c+'" checked></td>';for(var _=0;l>_;_++)"undefined"!=typeof p[_]&&(h=d?h+"<td><textarea disabled>"+escapeHTML(p[_]).replace(/\\"/g,'"').replace(/\\\\/g,"\\")+"</textarea></td>":h+"<td><textarea disabled>"+escapeHTML(p[_])+"</textarea></td>");h+="</tr>"}if(h+="</tbody>",u.append(h),e){$("#CSVtableDIV").show();var g=document.getElementById("CSVtableDIV").clientWidth,v=Math.max(document.body.scrollWidth,document.documentElement.scrollWidth,document.body.offsetWidth,document.documentElement.offsetWidth,document.body.clientWidth,document.documentElement.clientWidth),m=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight);$("#CSVtableScroll").css("maxHeight",.45*m),document.getElementById("CSVtableDIV").style.left=(v-g)/2+"px",document.getElementById("CSVtableDIV").style.top="20px",$("#CSVtableDIV").hide(),$("#app-settings-content").hide(),$("#CSVtableDIV").show(400)}a-o==1?$("#CSVpreviewTitle").text(t("passwords","Preview")+" ("+(a-o)+" "+t("passwords","Password").toLowerCase()+"):"):$("#CSVpreviewTitle").text(t("passwords","Preview")+" ("+(a-o)+" "+t("passwords","Passwords").toLowerCase()+"):"),$("#CSVcolumnCount").val(l),checkCSVsettings()}function checkCSVsettings(){for(var e=$("#CSVcolumnCount").val(),t="",s=!1,a=!1,r=!1,o=!1,n=0;e>n;n++)$("#CSVcolumnTD"+n).removeClass("CSVcolumnInvalid"),t+=$("#CSVcolumn"+n).val(),"website"==$("#CSVcolumn"+n).val()&&(a=!0),"username"==$("#CSVcolumn"+n).val()&&(r=!0),"password"==$("#CSVcolumn"+n).val()&&(o=!0);if((t.match(/website/g)||[]).length>1)for(var n=0;e>=n;n++)"website"==$("#CSVcolumn"+n).val()&&($("#CSVcolumnTD"+n).addClass("CSVcolumnInvalid"),s=!0);if((t.match(/username/g)||[]).length>1)for(n=0;e>n;n++)"username"==$("#CSVcolumn"+n).val()&&($("#CSVcolumnTD"+n).addClass("CSVcolumnInvalid"),s=!0);if((t.match(/password/g)||[]).length>1)for(n=0;e>n;n++)"password"==$("#CSVcolumn"+n).val()&&($("#CSVcolumnTD"+n).addClass("CSVcolumnInvalid"),s=!0);if((t.match(/url/g)||[]).length>1)for(n=0;e>n;n++)"url"==$("#CSVcolumn"+n).val()&&($("#CSVcolumnTD"+n).addClass("CSVcolumnInvalid"),s=!0);if((t.match(/notes/g)||[]).length>1)for(n=0;e>n;n++)"notes"==$("#CSVcolumn"+n).val()&&($("#CSVcolumnTD"+n).addClass("CSVcolumnInvalid"),s=!0);if(""!=$("#CSVerrorfield").text())throw $("#importStart").css("opacity",.5),$("#importStart")[0].disabled=!0,new Error("Invalid values. Check red text.");if($("#importStart").css("opacity",1),$("#importStart")[0].disabled=!1,s)throw new Error("Invalid values. Check red text.")}function importCSV(){for(var e=$("#CSVcolumnCount").val(),s=-1,a=-1,r=-1,o=-1,n=-1,i=1;e>=i;i++)"website"==$("#CSVcolumn"+i).val()&&(s=i),"username"==$("#CSVcolumn"+i).val()&&(a=i),"password"==$("#CSVcolumn"+i).val()&&(r=i),"url"==$("#CSVcolumn"+i).val()&&(o=i),"notes"==$("#CSVcolumn"+i).val()&&(n=i);if(-1==s||-1==a||-1==r)throw OCdialogs.alert(t("passwords","Fill in the website, user name and password."),t("passwords","Import CSV File"),function(){return!1},!0),new Error("Select a column for website, username and password.");for(var d=document.getElementById("CSVtable"),l="",c="",p="",u="",w="",h=[],_=1;_<d.rows.length;_++)if($("#CSVcheckRow"+_).is(":checked")){for(var g=0;e>=g;g++)g==s&&(c=d.rows[_].cells[g].textContent),g==a&&(l=d.rows[_].cells[g].textContent),g==r&&(u=d.rows[_].cells[g].textContent),g==o&&(p=d.rows[_].cells[g].textContent),g==n&&(w=d.rows[_].cells[g].textContent);p=p.toLowerCase(),""!=p&&"http://"!=p.substring(0,7).toLowerCase()&&"https://"!=p.substring(0,8).toLowerCase()&&(isUrl(p)?(p="http://"+p,isUrl(p)||(OCdialogs.alert(t("passwords","This is not a valid URL, so this value will not be saved:")+" "+p,t("passwords","Import CSV File"),function(){return!1},!0),p="")):(OCdialogs.alert(t("passwords","This is not a valid URL, so this value will not be saved:")+" "+p,t("passwords","Import CSV File"),function(){return!1},!0),p="")),h.push({website:c,pass:u,loginname:l,address:p,category:0,notes:w,deleted:"0"})}$("#CSVtableDIV").hide(),$("#CSVprogressDIV").show(),$("#CSVprogressActive").val(0),$("#CSVprogressTotal").val(h.length),importPassword(h)}function importPassword(e){var s=e[0];if(e.length>0){e.shift(),$("#CSVprogressActive").val($("#CSVprogressTotal").val()-e.length);var a=$("#CSVprogressActive").val()/$("#CSVprogressTotal").val()*100;$("#CSVprogressDone").css("width",a+"%"),$("#CSVprogressText1").text(s.website),$("#CSVprogressText2").text($("#CSVprogressActive").val()+" / "+$("#CSVprogressTotal").val()+" ("+Math.round(a)+"%)");$.ajax({url:generateUrl("/passwords"),method:"POST",contentType:"application/json",data:JSON.stringify(s),success:function(s){0==e.length&&setTimeout(function(){alert(t("passwords","Import of passwords done. This page will now reload.")),location.reload(!0)},500),importPassword(e)},error:function(e){setTimeout(function(){alert(t("passwords","Error: The password of website '%s' cannot be imported. However, the import progress will continue.").replace("%s",s.website))},500)}})}}function InvalidCSV(e){-1==$("#CSVerrorfield").text().indexOf(e)&&$("#CSVerrorfield").append("<p>"+e+"</p>")}function popUp(e,s,a,r,o,n,i){var d=""!=$("#ShareUsers").html();if($("#popup").html(""),$("#overlay").remove(),$("#popup").remove(),$("<div/>",{id:"overlay"}).appendTo($("#app")),$("#overlay").delay(200).css("opacity",.6),$("<div/>",{id:"popup"}).appendTo($("#app")),$("<div/>",{id:"popupTitle"}).appendTo($("#popup")),$("<span/>",{text:o}).appendTo($("#popupTitle")),$("<br/>").appendTo($("#popupTitle")),$("<span/>",{text:t("passwords","Login name")+": "+n,id:"popupSubTitle"}).appendTo($("#popupTitle")),$("<div/>",{id:"popupContent"}).appendTo($("#popup")),"share"==a?d&&$("<p/>",{text:t("passwords","Choose one or more users and press Share.")}).appendTo($("#popupContent")):"new_password"!=a&&(i||$("<p/>",{text:t("passwords","Enter a new value and press Save to keep the new value.\nThis cannot be undone.")}).appendTo($("#popupContent")),$("<br/>").appendTo($("#popupContent")),$("<p/>",{text:e+":"}).appendTo($("#popupContent"))),"notes"==a)$("<textarea/>",{id:"new_value_popup",rows:"5"}).val(s).appendTo($("#popupContent")),$("textarea").keydown(function(e){var t,s,a;return 9===e.keyCode?(a=this.selectionStart,s=this.selectionEnd,t=$(this),t.val(t.val().substring(0,a)+"	"+t.val().substring(s)),this.selectionStart=this.selectionEnd=a+1,!1):void 0});else if("category"==a)$("#popupContent").append('<div id="new_value_popup">'+$("#new_category").html()+"</div>"),-1==$("#new_category").html().indexOf(t("passwords","No categories"))&&($("#new_value_popup select option").last().remove(),$("#new_value_popup select").val(s)),$("#popupContent").append('<button id="editCategoriespopup">'+t("passwords","Edit categories")+"</button>"),$("#editCategoriespopup").click(function(){removePopup(),$("#app-settings-content").hide(200),$("#sidebarClose").click(),$("#section_table").hide(200),$("#section_categories").show(400)});else if("share"==a){var l=!1;if(d){if($("#popupContent").append('<div class="share_scroll"><div id="new_value_popup">'+$("#ShareUsers").html()+"</div></div>"),"undefined"!=typeof s){var c=s.replace(/(:|\.|@|\[|\])/g,"\\$1").split(",");$.each(c,function(e,t){$("#new_value_popup input[value="+t+"]").attr("checked",!0),l=!0})}}else $("<p/>",{text:t("passwords","There are no users available you can share with.")+"\n"+t("passwords","LDAP is unsupported in this version.")}).appendTo($("#popupContent"))}else"new_password"==a?($("#popupContent").append($("#add_password_div").html()),$("#add_password_div").html($("#add_password_div").html().replace(/id="/g,'id="disabled')),$("#popupTitle span").text(t("passwords","Add new password")),$("#popupSubTitle").remove(),$("#new_website").focus()):($("<input/>",{type:"text",id:"new_value_popup",autocorrect:"off",autocapitalize:"off",spellcheck:"false"}).val(s).appendTo($("#popupContent")),"password"==a?($("#new_value_popup").addClass("password_field"),$('<p id="generate_strength_popup"></p>').appendTo($("#popupContent")),$("<input>",{type:"checkbox",id:"gen_lower_popup"}).prop("checked",$("#gen_lower").is(":checked")).appendTo($("#popupContent")),$("<label/>",{"for":"gen_lower_popup",text:t("passwords","Lowercase characters")
}).appendTo($("#popupContent")),$("<br/>").appendTo($("#popupContent")),$("<input>",{type:"checkbox",id:"gen_upper_popup"}).prop("checked",$("#gen_upper").is(":checked")).appendTo($("#popupContent")),$("<label/>",{"for":"gen_upper_popup",text:t("passwords","Uppercase characters")}).appendTo($("#popupContent")),$("<br/>").appendTo($("#popupContent")),$("<input>",{type:"checkbox",id:"gen_numbers_popup"}).prop("checked",$("#gen_numbers").is(":checked")).appendTo($("#popupContent")),$("<label/>",{"for":"gen_numbers_popup",text:t("passwords","Numbers")}).appendTo($("#popupContent")),$("<br/>").appendTo($("#popupContent")),$("<input>",{type:"checkbox",id:"gen_special_popup"}).prop("checked",$("#gen_special").is(":checked")).appendTo($("#popupContent")),$("<label/>",{"for":"gen_special_popup",text:t("passwords","Punctuation marks")}).appendTo($("#popupContent")),$("<br/>").appendTo($("#popupContent")),$("<input/>",{type:"text",id:"gen_length_popup",value:$("#gen_length").val()}).appendTo($("#popupContent")),$("<label/>",{text:t("passwords","characters")}).appendTo($("#popupContent")),$("<br/>").appendTo($("#popupContent")),$("<button/>",{id:"new_generate_popup",text:t("passwords","Generate password")}).appendTo($("#popupContent")),$("<br/>").appendTo($("#popupContent"))):"website"==a&&($("<br/><br/>").appendTo($("#popupContent")),$("<p/>",{text:t("passwords","Full URL (optional)")+":"}).appendTo($("#popupContent")),$("<input/>",{type:"text",id:"new_address_popup",autocorrect:"off",autocapitalize:"off",spellcheck:"false"}).val(r).appendTo($("#popupContent")),$("<p/>",{id:"popupInvalid",text:t("passwords","Fill in a valid URL.")+" "+t("passwords","Note: This field is optional and can be left blank.")}).appendTo($("#popupContent"))),("website"==a||"loginname"==a||"password"==a)&&($("<input>",{type:"checkbox","class":"checkbox",id:"keep_old_popup"}).prop("checked","true").appendTo($("#popupContent")),$("<label/>",{"for":"keep_old_popup",text:t("passwords","Move old value to trash bin")}).appendTo($("#popupContent"))));$("<div/>",{id:"popupButtons"}).appendTo($("#popup")),$("<button/>",{id:"cancel",text:t("passwords","Cancel")}).appendTo($("#popupButtons")),i||("share"==a&&d?($("<button/>",{id:"accept",text:t("passwords","Share")}).appendTo($("#popupButtons")),l&&($("<button/>",{id:"stop",text:t("passwords","Stop sharing")}).appendTo($("#popupButtons")),$("#stop").click(function(){$("#new_value_popup input").each(function(){this.checked=!1}),$("#accept").click()}))):"new_password"==a?($("<button/>",{id:"accept",text:t("core","Add")}).appendTo($("#popupButtons")),$("<button/>",{id:"clear",text:t("passwords","Clear")}).appendTo($("#popupButtons"))):$("<button/>",{id:"accept",text:t("passwords","Save")}).appendTo($("#popupButtons"))),$("#overlay").click(function(){removePopup()}),$("#cancel").click(function(){removePopup()}),"password"==a&&(strength_str($("#new_value_popup").val(),!1),$("#generate_strength").text(""),$("#generate_passwordtools").hide(),$("#new_value_popup").keyup(function(){strength_str(this.value,!1),$("#generate_strength").text("")}),$("#new_generate_popup").click(function(){var e=$("#gen_lower_popup").prop("checked"),s=$("#gen_upper_popup").prop("checked"),a=$("#gen_numbers_popup").prop("checked"),r=$("#gen_special_popup").prop("checked"),o=$("#gen_length_popup").val(),n="";return!isNumeric(o)||0==o.length||4>o?(OCdialogs.alert(t("passwords","Fill in a valid number as length with a minimum of 4."),t("passwords","Generate password"),function(){return!1},!0),!1):e||s||a||r?(n=generatepw(e,s,a,r,o),strength_str(n,!1),$("#new_value_popup").val(n),void $("#generate_strength").text("")):(OCdialogs.alert(t("passwords","Select at least one option to generate a password."),t("passwords","Generate password"),function(){return!1},!0),!1)}));var p=document.getElementById("popup").clientHeight,u=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight);u>p&&(document.getElementById("popup").style.top=(u-p)/4+"px"),$("#popupTitle").click()}function removePopup(){$("#add_password_div").html($("#add_password_div").html().replace(/id="disabled/g,'id="')),$("#overlay").css("opacity",0),$("#popup").hide(200),$("#popup").css("top","0"),setTimeout(function(){$("#overlay").remove(),$("#popup").remove()},300)}function trashAllPasswords(e){var s=new e(generateUrl("/passwords")),a=0;$("#PasswordsTableContent tbody tr").each(function(){var e=$(this),r=e.closest("td.icon-info");if(!e.hasClass("is_deleted")){var o=s.updateActive(e.attr("attr_id"),e.attr("attr_loginname"),e.attr("attr_website"),e.attr("attr_address"),e.attr("attr_pass"),e.attr("attr_notes"),"",e.attr("attr_category"),"1");o?(a++,e.attr("class","is_deleted"),r.removeClass("icon-info"),r.addClass("icon-history"),e.hide(),formatTable(!0)):OCdialogs.alert(t("passwords","Error: Could not update password."),t("passwords","Save"),function(){return!1},!0)}}),a>0?OCdialogs.info(t("passwords","All passwords were moved to the trash bin."),t("passwords","Trash bin"),function(){return!1},!0):OCdialogs.info(t("passwords","There are no passwords to be moved."),t("passwords","Trash bin"),function(){return!1},!0)}function showSidebar(e){$("#app-content-wrapper").attr("class","content-wrapper-sidebar"),document.getElementById("app-sidebar-wrapper").style.top=document.getElementById("header").clientHeight+35+"px",$("#app-sidebar-wrapper").show(200),$("#sidebarRow").val(e.attr("attr_id")),$("#sidebarWebsite").text(e.attr("attr_website")),$("#sidebarAddress").text(e.attr("attr_address")),""==$("#sidebarAddress").text()&&$("#sidebarAddress").text("("+t("passwords","None")+")"),$("#sidebarUsername").text(e.attr("attr_loginname")),$("#sidebarLength").text(e.attr("attr_length")),$("#sidebarStrength").text(e.attr("attr_strength")+" ("+strength_func(e.attr("attr_pass"))+")"),$("#sidebarStrength").attr("class",strength_str2class(e.attr("attr_strength"))),$("#sidebarStrength").addClass("rightCol");var s=bool2class_str(e.attr("attr_lower"));$("#sidebarLower").attr("class",s[0]),$("#sidebarLower").text(s[1]),$("#sidebarLower").addClass("rightCol");var a=bool2class_str(e.attr("attr_upper"));$("#sidebarUpper").attr("class",a[0]),$("#sidebarUpper").text(a[1]),$("#sidebarUpper").addClass("rightCol");var r=bool2class_str(e.attr("attr_number"));$("#sidebarNumber").attr("class",r[0]),$("#sidebarNumber").text(r[1]),$("#sidebarNumber").addClass("rightCol");var o=bool2class_str(e.attr("attr_special"));$("#sidebarSpecial").attr("class",o[0]),$("#sidebarSpecial").text(o[1]),$("#sidebarSpecial").addClass("rightCol");var n=new Date(e.attr("attr_datechanged"));$("#sidebarChanged").html(date2str(n,!1)+" ("+date2str(n,!0)+")"),$("#sidebarChanged").attr("class",date2class(n)),$("#sidebarChanged").addClass("rightCol"),$("#sidebarNotes").text(e.attr("attr_notes")),""==$("#sidebarNotes").text()&&$("#sidebarNotes").text("("+t("passwords","None")+")");var i=e.attr("attr_category");$("#sidebarCategories").text(""),$("#CategoriesTableContent tr").each(function(){var e=$(this).find(".catTable_id").text();if(e==i){var t=$(this).find(".catTable_name").text();$("#sidebarCategories").text(t)}}),""==$("#sidebarCategories").text()&&$("#sidebarCategories").text("("+t("passwords","None")+")")}function resetTimer(e){if(0==$("#app-settings").attr("timer"))return!1;var s=$("#app-settings").attr("timer"),a=$("#app-settings").attr("session-timeout");$("#idleTimer").show(500),$("#outerRing").show(500),$("#countSec").text(int2time(s,!1)),61>s?$("#countSec").css("font-size","30px"):$("#countSec").css("font-size","16px"),e&&clearInterval(intervalID),intervalID=setInterval(function(){s-=1,a-=1,$("#countSec").text(int2time(s,!1)),$("#session_lifetime").text(a),61>s?$("#countSec").css("font-size","30px"):$("#countSec").css("font-size","16px"),(1>=s||1>=a)&&$("#PasswordsTable table td").hide(),0>=s&&(clearInterval(intervalID),"none"==$("#app-settings").attr("auth_type")?(alert(t("passwords","You will be logged off due to inactivity of %s seconds.").replace("%s",$("#app-settings").attr("timer"))+"\n\n"+t("passwords","You can change the timer settings in the '%s' menu.").replace("%s",t("core","Personal"))),document.cookie="oc_sessionPassphrase=; expires=Thu, 01 Jan 1970 00:00:00 UTC",window.location=window.location):(document.cookie="oc_passwords_auth="+SHA512($("head").attr("data-user"))+"; expires=Thu, 01 Jan 1970 00:00:00 UTC",document.cookie="oc_passwords_auth="+SHA512($("head").attr("data-user"))+"; expires=Thu, 01 Jan 1970 00:00:00 UTC",setTimeout(function(){$("#lock_btn").click()},1e3))),0>=a&&("none"==$("#app-settings").attr("auth_type")?(alert(t("passwords","You will be logged off due to expiration of your session cookie (set to %s minutes).").replace("%s",int2time($("#app-settings").attr("session-timeout"),!0))),document.cookie="oc_sessionPassphrase=; expires=Thu, 01 Jan 1970 00:00:00 UTC",window.location=window.location):(document.cookie="oc_passwords_auth="+SHA512($("head").attr("data-user"))+"; expires=Thu, 01 Jan 1970 00:00:00 UTC",document.cookie="oc_passwords_auth="+SHA512($("head").attr("data-user"))+"; expires=Thu, 01 Jan 1970 00:00:00 UTC",setTimeout(function(){$("#lock_btn").click()},1e3)))},1e3)}function int2time(e,t){return"undefined"!=typeof e?61>e&&!t?e:new Date(null,null,null,null,null,e).toTimeString().match(/\d{2}:\d{2}:\d{2}/)[0].substr(3,5):void 0}function getContrastYIQ(e){3==e.length&&(e=e.substr(0,1)+e.substr(0,1)+e.substr(1,1)+e.substr(1,1)+e.substr(2,1)+e.substr(2,1));var t=parseInt(e.substr(0,2),16),s=parseInt(e.substr(2,2),16),a=parseInt(e.substr(4,2),16),r=(299*t+587*s+114*a)/1e3;return r>=128?"000000":"ffffff"}function updateRequired(){$("#section_update").show(),$("#section_table").hide(),$("#section_categories").hide()}function updateStart(e){$("#update_start_btn").hide(),$("#update_progress").show();var s=document.getElementById("PasswordsTableTestOld");$("#update_progress_active").val(0),$("#update_progress_total").val(s.rows.length);var a=$("#update_progress_active").val()/$("#update_progress_total").val()*100;$("#update_progress_done").css("width",a+"%"),$("#update_progress_text").text($("#update_progress_active").val()+" / "+$("#update_progress_total").val()+" ("+Math.round(a)+"%)");for(var r=!0,o=0;o<s.rows.length;o++){$("#update_progress_active").val(o+1),a=$("#update_progress_active").val()/$("#update_progress_total").val()*100,$("#update_progress_done").css("width",a+"%"),$("#update_progress_text").text($("#update_progress_active").val()+" / "+$("#update_progress_total").val()+" ("+Math.round(a)+"%)");var n=s.rows[o].cells[0].textContent,i=s.rows[o].cells[1].textContent,d=s.rows[o].cells[2].textContent,l=s.rows[o].cells[4].textContent,c=s.rows[o].cells[5].textContent,p=s.rows[o].cells[7].textContent,u=s.rows[o].cells[8].textContent,w=s.rows[o].cells[9].textContent;if(""!=i){var h=e.updateActive(c,i,n,p,d,u,"",0,w,l);h||(r=!1)}}setInterval(function(){r&&100==a?($("#update_progress").hide(),$("#update_done").show(),$("#update_done_btn").click(function(){location.reload(!0)})):100==a&&alert(t("passwords","Error: Could not update password."))},1e3)}function updateDone(){$("#section_update").hide(),$("#section_table").show(),$("#section_categories").show()}function generateUrl(e){var t=$("#app-settings").attr("root-folder"),s=$("#app-settings").attr("app-path")+"/passwords";s=s.replace(/\/\//g,"/");var a=s.replace(t,""),r=OC.generateUrl(a+"/"+e);return r=r.replace(/\/\//g,"/")}!function(e,s,a,r){"use strict";a(document).ready(function(){a(document.body).click(function(e){var t=a("#commands_popup");t.has(e.target).length||(t.slideUp(100),a(".activerow").removeClass("activerow"))}),a("#settingsbtn").text(t("core","Settings"));var e=function(e){this._baseUrl=e,this._passwords=[],this._activePassword=r};e.prototype={load:function(e){var t=this;this._passwords.forEach(function(s){s.id===e?(s.active=!0,t._activePassword=s):s.active=!1})},getActive:function(){return this._activePassword},removeActive:function(){var e,t=a.Deferred(),s=this._activePassword.id;return this._passwords.forEach(function(t,a){t.id===s&&(e=a)}),e!==r?(this._activePassword===this._passwords[e]&&delete this._activePassword,this._passwords.splice(e,1),a.ajax({url:this._baseUrl+"/"+s,method:"DELETE"}).done(function(){t.resolve()}).fail(function(){t.reject()})):t.reject(),t.promise()},removeByID:function(e){var t=e,s=a.Deferred();return t!==r?(this._activePassword===this._passwords[t]&&delete this._activePassword,this._passwords.splice(t,1),a.ajax({url:this._baseUrl+"/"+e,method:"DELETE"}).done(function(){s.resolve()}).fail(function(){s.reject()})):s.reject(),s.promise()},create:function(e){var t=a.Deferred();return a.ajax({url:this._baseUrl,method:"POST",contentType:"application/json",data:JSON.stringify(e)}).done(function(e){t.resolve()}).fail(function(){t.reject()}),t.promise()},getAll:function(){return this._passwords},loadAll:function(){var e=a.Deferred(),t=this;return a.get(this._baseUrl).done(function(s){t._activePassword=r,t._passwords=s,e.resolve()}).fail(function(){e.reject()}),e.promise()},updateActive:function(e,t,s,o,n,i,d,l,c,p){var u=[];if(u=a.isArray(d)?d:d?d.split(", "):"",p==r)var w=new Date,p=w.getFullYear()+"-"+("0"+(w.getMonth()+1)).slice(-2)+"-"+("0"+w.getDate()).slice(-2);n||(n=" ");var h={id:e,website:s,pass:n,loginname:t,address:o,category:l,notes:i,sharewith:u,deleted:c,datechanged:p};return a.ajax({url:this._baseUrl+"/"+h.id,method:"PUT",contentType:"application/json",data:JSON.stringify(h)})}};var o=function(e){this._baseUrl=e,this._categories=[]};o.prototype={load:function(e){var t=this;this._categories.forEach(function(s){s.id===e?(s.active=!0,t._activecategory=s):s.active=!1})},removeByID:function(e){var t=e,s=a.Deferred();return t!==r?(this._categories.splice(t,1),a.ajax({url:this._baseUrl+"/"+e,method:"DELETE"}).done(function(){s.resolve()}).fail(function(){s.reject()})):s.reject(),s.promise()},create:function(e){var t=a.Deferred();return a.ajax({url:this._baseUrl,method:"POST",contentType:"application/json",data:JSON.stringify(e)}).done(function(e){t.resolve()}).fail(function(){t.reject()}),t.promise()},getAll:function(){return this._categories},loadAll:function(){var e=a.Deferred(),t=this;return a.get(this._baseUrl).done(function(s){t._categories=s,e.resolve()}).fail(function(){e.reject()}),e.promise()}};var n=function(e){this._baseUrl=e,this._settings=[]};n.prototype={load:function(){var e=a.Deferred(),t=this;return a.ajax({url:this._baseUrl,method:"GET",async:!1}).done(function(e){t._settings=e}).fail(function(){e.reject()}),e.promise()},setUserKey:function(e,s){var r=a.Deferred();a.ajax({url:this._baseUrl+"/"+e+"/"+s,method:"POST"}).done(function(e){r.resolve(e)}).fail(function(){alert(t("passwords","Error while saving field")+" "+e+"!"),r.reject()})},getKey:function(e){for(var t in this._settings)if(t==e)return this._settings[t]},getAll:function(){return this._settings}};var i=function(e){this._passwords=e};i.prototype={renderContent:function(){var r=a("#template-passwords-old").html(),n=Handlebars.compile(r),d=n({passwords:this._passwords.getAll()});a("#PasswordsTableTestOld").html(d);var c=document.getElementById("PasswordsTableTestOld");if(c){for(var p=0;p<c.rows.length;p++)if(resetTimer(!0),""!=c.rows[p].cells[0].textContent&&""!=c.rows[p].cells[1].textContent)var u=!0;if(u)return a("#update_start_btn").click(function(){updateStart(l)}),updateRequired(),!1;a("#PasswordsTableTestOld").hide(),a("#PasswordsTableTestOld").remove()}r=a("#template-passwords-serialize").html(),n=Handlebars.compile(r);var w=n({passwords:this._passwords.getAll()});w=a("<textarea/>").html(w).text();var h=w.split("<br>");formatTable(!1,h),a("tr").click(function(e){a("tr").removeClass("activerow")}),a(".btn_commands_open").click(function(e){if(e.stopPropagation(),a("tr").removeClass("activerow"),"block"==a("#commands_popup").css("display"))return a("#commands_popup").slideUp(150),!1;var t=a(this).closest("tr"),s=a(this).closest("td");if(t.addClass("activerow"),a("#commands_popup").hide(),a("#cmd_id").val(t.attr("attr_id")),a("#cmd_type").val(s.attr("type")),a("#cmd_value").val(t.attr("attr_"+s.attr("type"))),a("#cmd_website").val(t.attr("attr_website")),a("#cmd_address").val(t.attr("attr_address")),a("#cmd_loginname").val(t.attr("attr_loginname")),a("#cmd_pass").val(t.attr("attr_pass")),a("#cmd_notes").val(t.attr("attr_notes")),a("#cmd_sharedwith").val(t.attr("attr_sharedwith")),a("#cmd_category").val(t.attr("attr_category")),a("#cmd_deleted").val(t.hasClass("is_deleted")),t.hasClass("is_sharedby")?(a("#btn_edit").hide(),a("#commands_popup input").css("width","170px")):(a("#btn_edit").show(),a("#commands_popup input").css("width","80px")),a("#btn_copy").attr("data-clipboard-text",a("#cmd_value").val()),"absolute"==a("#app-navigation").css("position"))var r=a(this).position().left;else var r=a(this).position().left+a("#app-navigation").width();r=r+a(".btn_commands_open").width()-a("#commands_popup").width()/2;var o=a(this).position().top+a("#header").height()+25;a("#commands_popup").css("left",r+"px"),a("#commands_popup").css("top",o+"px"),a("#commands_popup").slideDown(150)}),a("#colorpicker").spectrum({color:"#eeeeee",showInput:!0,showButtons:!1,showInitial:!1,allowEmpty:!1,showAlpha:!1,showPalette:!0,showPaletteOnly:!1,togglePaletteOnly:!1,showSelectionPalette:!1,clickoutFiresChange:!0,hideAfterPaletteSelect:!0,containerClassName:"category_colorpicker",replacerClassName:"category_colorpicker",preferredFormat:"hex",palette:[["#000000","#444444","#666666","#999999","#cccccc","#eeeeee","#f3f3f3","#ffffff"],["#ff0000","#ff9900","#ffff00","#00ff00","#00ffff","#0000ff","#9900ff","#ff00ff"],["#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#cfe2f3","#d9d2e9","#ead1dc"],["#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#9fc5e8","#b4a7d6","#d5a6bd"],["#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6fa8dc","#8e7cc3","#c27ba0"],["#cc0000","#e69138","#f1c232","#6aa84f","#45818e","#3d85c6","#674ea7","#a64d79"],["#990000","#b45f06","#bf9000","#38761d","#134f5c","#0b5394","#351c75","#741b47"],["#660000","#783f04","#7f6000","#274e13","#0c343d","#073763","#20124d","#4c1130"]],move:function(e){a("#cat_colour").val(e.toHexString())},change:function(e){a("#cat_colour").val(e.toHexString())},hide:function(e){a("#cat_colour").val(e.toHexString())}}),a("#btn_copy").click(function(){var e=new Clipboard("#btn_copy");e.on("success",function(e){a("#zeroclipboard_copied").slideDown(50),setTimeout(function(){a("#zeroclipboard_copied").slideUp(100)},1500),e.clearSelection()}),e.on("error",function(e){var r="";switch(a("#cmd_type").val()){case"website":r=t("passwords","Website or company");break;case"loginname":r=t("passwords","Login name");break;case"pass":r=t("passwords","Password")}a("#commands_popup").slideUp(100),a(".activerow").removeClass("activerow"),setTimeout(function(){s.prompt(r+":",a("#cmd_value").val()),e.stopPropagation},100)})}),a("#btn_invalid_sharekey").click(function(){OCdialogs.alert(t("passwords","You do not have a valid share key, to decrypt this password. Ask the user that shared this password with you, to reshare it."),t("passwords","Invalid share key"),function(){return!1},!0)}),a("#btn_edit").click(function(){var s="",r="";switch(a("#cmd_type").val()){case"website":s="website",r=t("passwords","Website or company");break;case"loginname":s="loginname",r=t("passwords","Login name");break;case"pass":s="password",r=t("passwords","Password")}return popUp(r,a("#cmd_value").val(),s,a("#cmd_address").val(),a("#cmd_website").val(),a("#cmd_loginname").val()),a("#accept").click(function(){var r=a("#new_value_popup").val();if("website"==s){if(""!=a("#new_address_popup").val()&&"http://"!=a("#new_address_popup").val().substring(0,7).toLowerCase()&&"https://"!=a("#new_address_popup").val().substring(0,8).toLowerCase()&&"www."!=a("#new_address_popup").val().substring(0,4).toLowerCase()){if(!isUrl(a("#new_address_popup").val()))return a("#popupInvalid").show(),a("#new_address_popup").select(),!1;if(a("#new_address_popup").val("http://"+a("#new_address_popup").val()),!isUrl(a("#new_address_popup").val()))return a("#popupInvalid").show(),a("#new_address_popup").select(),!1}var o=a("#new_address_popup").val()}var n=new e(generateUrl("/passwords"));if(1==a("#keep_old_popup").prop("checked")){var d=a("#cmd_pass").val(),l={website:a("#cmd_website").val(),pass:d,loginname:a("#cmd_loginname").val(),address:a("#cmd_address").val(),category:a("#cmd_category").val(),notes:a("#cmd_notes").val(),deleted:"1"};n.create(l).done(function(){var t=new e(generateUrl("/passwords")),s=new i(t);t.loadAll().done(function(){s.renderContent()})}).fail(function(){return OCdialogs.alert(t("passwords","Error: Could not create password."),t("passwords","Save"),function(){return!1},!0),!1})}switch(s){case"website":a("#cmd_website").val(r),a("#cmd_address").val(o);break;case"loginname":a("#cmd_loginname").val(r);break;case"password":a("#cmd_pass").val(r)}var c=n.updateActive(a("#cmd_id").val(),a("#cmd_loginname").val(),a("#cmd_website").val(),a("#cmd_address").val(),a("#cmd_pass").val(),a("#cmd_notes").val(),a("#cmd_sharedwith").val(),a("#cmd_category").val(),a("#cmd_deleted").val());if(c){var n=new e(generateUrl("/passwords")),p=new i(n);n.loadAll().done(function(){p.renderContent()});var u=a("#template-passwords-serialize").html(),w=Handlebars.compile(u),h=w({passwords:n.getAll()});h=h.replace(/&quot;/g,'"');var _=h.split("<br>");formatTable(!1,_)}else OCdialogs.alert(t("passwords","Error: Could not update password."),t("passwords","Save"),function(){return!1},!0);removePopup()}),!1}),a("#btn_share").click(function(){var e=a("#cmd_id").val(),t=findRow(e);a(t).find(".icon-share").click()}),a("#btn_clone").click(function(){a("#new_address").attr("value",a("#cmd_address").val()),a("#new_notes").text(a("#cmd_notes").val()),a("#new_website").attr("value",a("#cmd_website").val()),a("#new_username").attr("value",a("#cmd_loginname").val()),a("#new_password").attr("value",a("#cmd_pass").val()),webimg2new(),strength_str(a("#cmd_pass").val(),!1),a("#add_new").click()}),a("#app-settings-content").hide(),a("#idleTimer").mouseenter(function(e){resetTimer(!0)}),a("#countSec").mouseenter(function(e){resetTimer(!0)}),a("#back_to_passwords").click(function(){a("#section_table").show(200),a("#section_categories").hide(100)}),a("#CategoriesTableContent").on("click","td",function(){var s=a(this),r=s.closest("tr"),n=(r.closest("table").find("tr").length,r.find(".catTable_id").text()),i=r.find(".catTable_name").text(),d=s.hasClass("icon-delete");d&&OCdialogs.confirm(t("passwords","This will delete the category")+" '"+i+"'. "+t("passwords","Are you sure?"),t("passwords","Category"),function(s){if(s){var a=new e(generateUrl("/categories"));a.removeByID(n).done(function(){setTimeout(function(){a=new o(generateUrl("/categories")),a.loadAll().done(function(){renderCategories(a)}).fail(function(){OCdialogs.alert(t("passwords","Error: Could not load categories."),t("passwords","Passwords"),function(){return!1},!0)})},500)}).fail(function(){OCdialogs.alert(t("passwords","Error: Could not delete category."),t("passwords","Category"),function(){return!1},!0)})}})}),a("#cat_add").click(function(){if(0==a("#cat_name").val().length)return!1;var e=new o(generateUrl("/categories")),s=a("#cat_name").val(),r=a("#cat_colour").val();r=r.replace("#","");var n={categoryName:s,categoryColour:r},i=e.create(n);i?(a("#cat_name").val(""),a("#cat_colour").val("#eeeeee"),a("#colorpicker").spectrum("set","eeeeee"),setTimeout(function(){e=new o(generateUrl("/categories")),e.loadAll().done(function(){renderCategories(e)}).fail(function(){OCdialogs.alert(t("passwords","Error: Could not load categories."),t("passwords","Passwords"),function(){return!1},!0)})},500)):OCdialogs.alert(t("passwords","Error: Could not create category."),t("passwords","Categories"),function(){return!1},!0)}),a("#sidebarClose").click(function(){a("#sidebarRow").val(""),a("#app-content-wrapper").attr("class",""),a("#app-sidebar-wrapper").hide(100)}),a("#delete_trashbin").click(function(s){OCdialogs.confirm(t("passwords","This will permanently delete all passwords in this trash bin.")+" "+t("passwords","Are you sure?"),t("passwords","Trash bin"),function(s){s&&(a("#PasswordsTableContent tr").each(function(){var t=a(this),s=t.hasClass("is_deleted"),r=t.attr("attr_id"),o=new e(generateUrl("/passwords"));s&&o.removeByID(r).done(function(){t.remove(),formatTable(!0)}).fail(function(){})}),setTimeout(function(){alert(t("passwords","Deletion of all trashed passwords done."))},3e3))},!0)}),a("#PasswordsTableContent td").click(function(s){var r=a(this),o=r.closest("tr"),n=r.hasClass("cell_strength"),d=r.hasClass("cell_datechanged"),l=r.hasClass("icon-notes"),c=r.hasClass("cell_category"),p=r.hasClass("icon-info"),u=r.hasClass("icon-share"),w=r.hasClass("icon-shared"),h=r.hasClass("icon-public"),_=r.hasClass("icon-delete"),g=r.hasClass("icon-history"),v=a("#app-settings").attr("active-table"),m="loginname"==r.attr("type")||"pass"==r.attr("type"),f=r.find(".btn_commands_open");if(m)return f.click(),a("#btn_copy").click(),a(document.body).click(),!1;var b=new e(generateUrl("/passwords"));if(c)return popUp(t("passwords","Category"),o.attr("attr_category"),"category","",o.attr("attr_website"),o.attr("attr_loginname")),a("#accept").click(function(){o.attr("attr_category",a("#new_value_popup select").val());var e=b.updateActive(o.attr("attr_id"),o.attr("attr_loginname"),o.attr("attr_website"),o.attr("attr_address"),o.attr("attr_pass"),o.attr("attr_notes"),o.attr("attr_sharedwith"),o.attr("attr_category"),o.hasClass("is_deleted"));if(e){var s=new i(b);b.loadAll().done(function(){s.renderContent()});var r=a("#template-passwords-serialize").html(),n=Handlebars.compile(r),d=n({passwords:b.getAll()});d=d.replace(/&quot;/g,'"');var l=d.split("<br>");formatTable(!1,l)}else OCdialogs.alert(t("passwords","Error: Could not update password."),t("passwords","Save"),function(){return!1},!0);removePopup()}),!1;if(u||h)return popUp(t("passwords","Share"),o.attr("attr_sharedwith"),"share","",o.attr("attr_website"),o.attr("attr_loginname")),a("#accept").click(function(){var e=[];a("#new_value_popup input:checked").each(function(){e.push(a(this).val())});var s=b.updateActive(o.attr("attr_id"),o.attr("attr_loginname"),o.attr("attr_website"),o.attr("attr_address"),o.attr("attr_pass"),o.attr("attr_notes"),e,o.attr("attr_category"),o.hasClass("is_deleted"));s?0==e.length?(o.attr("attr_sharedwith",""),r.removeClass("icon-public"),r.addClass("icon-share"),r.find("div").removeClass("is_sharedto"),r.find("div span").text(0)):(o.attr("attr_sharedwith",e.join(",")),r.removeClass("icon-share"),r.addClass("icon-public"),r.find("div").addClass("is_sharedto"),r.find("div span").text(e.length)):OCdialogs.alert(t("passwords","Error: Could not update password."),t("passwords","Save"),function(){return!1},!0),removePopup()}),!1;if(w)return OCdialogs.info(t("passwords","Shared by %s").replace("%s",uid2displayname(o.attr("sharedby")))+".",t("passwords","Share"),function(){return!1},!0),!1;if(l)return popUp(t("passwords","Notes"),o.attr("attr_notes"),"notes","",o.attr("attr_website"),o.attr("attr_loginname"),o.hasClass("is_sharedby")),a("#accept").click(function(){o.attr("attr_notes",a("#new_value_popup").val());var e=b.updateActive(o.attr("attr_id"),o.attr("attr_loginname"),o.attr("attr_website"),o.attr("attr_address"),o.attr("attr_pass"),o.attr("attr_notes"),o.attr("attr_sharedwith"),o.attr("attr_category"),o.hasClass("is_deleted"));e?0==o.attr("attr_notes").length?r.removeClass("has-note"):r.addClass("has-note"):OCdialogs.alert(t("passwords","Error: Could not update password."),t("passwords","Save"),function(){return!1},!0),removePopup()}),!1;if(p||n||d)return a("#sidebarRow").val()==o.attr("attr_id")?(a("#sidebarRow").val(""),a("#app-content-wrapper").attr("class",""),a("#app-sidebar-wrapper").hide(100)):showSidebar(o),!1;if(_)if("active"==v){var C=b.updateActive(o.attr("attr_id"),o.attr("attr_loginname"),o.attr("attr_website"),o.attr("attr_address"),o.attr("attr_pass"),o.attr("attr_notes"),"",o.attr("attr_category"),"1");if(C){var $=null!=o.attr("attr_sharedwith")&&""!=o.attr("attr_sharedwith");o.addClass("is_deleted"),o.hide(),o.find(".icon-info").removeClass("icon-info").addClass("icon-history"),o.attr("attr_sharedwith",""),o.find(".icon-public").removeClass("icon-public").addClass("icon-share"),o.find("is_sharedto span").text(0),o.find(".is_sharedto").removeClass("is_sharedto"),formatTable(!0),$?OCdialogs.info(t("passwords","The password was moved to the trash bin.")+" "+t("passwords","This password is no longer shared anymore."),t("passwords","Trash bin"),function(){return!1},!0):OCdialogs.info(t("passwords","The password was moved to the trash bin."),t("passwords","Trash bin"),function(){return!1},!0)}else OCdialogs.alert(t("passwords","Error: Could not update password."),t("passwords","Trash bin"),function(){return!1},!0)}else OCdialogs.confirm(t("passwords","This will delete the password for")+" '"+o.attr("attr_website")+"' "+t("passwords","with user name")+" '"+o.attr("attr_loginname")+"'. "+t("passwords","Are you sure?"),t("passwords","Trash bin"),function(e){if(e){new i(b);b.removeByID(o.attr("attr_id")).done(function(){o.remove(),formatTable(!0)}).fail(function(){OCdialogs.alert(t("passwords","Error: Could not delete password."),t("passwords","Trash bin"),function(){return!1},!0)})}});if(g){var C=b.updateActive(o.attr("attr_id"),o.attr("attr_loginname"),o.attr("attr_website"),o.attr("attr_address"),o.attr("attr_pass"),o.attr("attr_notes"),"",o.attr("attr_category"),"0");C?(r.removeClass("icon-history").addClass("icon-info"),o.removeClass("is_deleted"),o.hide(),formatTable(!0)):OCdialogs.alert(t("passwords","Error: Could not update password."),t("passwords","Trash bin"),function(){return!1},!0)}})},renderNavigation:function(){a("#lock_btn").click(function(){document.cookie="oc_passwords_auth="+SHA512(a("head").attr("data-user"))+"; expires=Thu, 01 Jan 1970 00:00:00 UTC",s.location=s.location});var r=new n(generateUrl("/settings"));r.load(),"true"==r.getKey("backup_allowed").toLowerCase()==0?a("#app-settings-backup").remove():a("#app-settings-backup").show(),a("#app-settings").attr("timer",r.getKey("timer")),a("#app-settings").attr("days-orange",r.getKey("days_orange")),a("#app-settings").attr("days-red",r.getKey("days_red")),"true"==r.getKey("icons_allowed").toLowerCase()?(a("#app-settings").attr("icons-show","true"==r.getKey("icons_show").toLowerCase()),a("#app-settings").attr("icons-service",r.getKey("icons_service"))):a("#app-settings").attr("icons-show","false"),a("#app-settings").attr("hide-passwords","true"==r.getKey("hide_passwords").toLowerCase()),a("#app-settings").attr("hide-usernames","true"==r.getKey("hide_usernames").toLowerCase()),a("#app-settings").attr("hide-attributes","true"==r.getKey("hide_attributes").toLowerCase()),a("#app-settings").attr("auth_type",r.getKey("extra_auth_type")),a("#extra_password").val(r.getKey("extra_auth_type")),"master"==r.getKey("extra_auth_type")&&a("#div_edit_master_password").show(),a("#show_lockbutton").prop("checked","true"==r.getKey("show_lockbutton").toLowerCase()),"none"==r.getKey("extra_auth_type")?(a("#show_lockbutton_div").hide(),a("#div_extra_auth_password").hide()):a("#lock_btn").show(200),a("#auth_timer").val(r.getKey("auth_timer")),a("#auth_timer").val()<61?a("#auth_timersettext").text(t("passwords","seconds")):a("#auth_timersettext").text(t("passwords","seconds")+" ("+int2time(a("#auth_timer").val())+" "+t("passwords","minutes")+")"),a("#auth_timer").keyup(function(){if(""==a("#auth_timer").val())r.setUserKey("auth_timer",3);else{if(!isNumeric(a("#auth_timer").val()))return OCdialogs.alert(t("passwords","Fill in a number between %s and %s").replace("%s","10").replace("%s","3599"),t("passwords","Passwords"),function(){return!1},!0),a("#auth_timer").val(300),
r.setUserKey("auth_timer",300),!1;a("#auth_timer").val()>3599&&a("#auth_timer").val(3599),a("#auth_timer").val()<61?a("#auth_timersettext").text(t("passwords","seconds")):a("#auth_timersettext").text(t("passwords","seconds")+" ("+int2time(a("#auth_timer").val())+" "+t("passwords","minutes")+")"),r.setUserKey("auth_timer",a("#auth_timer").val())}}),a("#show_lockbutton").change(function(){r.setUserKey("show_lockbutton",a(this).is(":checked")),a(this).is(":checked")?a("#lock_btn").show(100):a("#lock_btn").hide(100)}),a("#div_edit_master_password").click(function(){a("#div_master_password").show(300),a(this).hide(150)}),a("#extra_password").change(function(){var e=a("#extra_password option:selected").val();if("master"==e||"owncloud"==e?(r.setUserKey("show_lockbutton",!0),a("#show_lockbutton").prop("checked",!0),a("#lock_btn").show(300),a("#show_lockbutton_div").show(300),a("#div_extra_auth_password").show(300)):(a("#show_lockbutton_div").hide(300),a("#div_extra_auth_password").hide(300),a("#lock_btn").hide(100)),"master"!=e){if(a("#div_master_password").hide(300),a("#div_edit_master_password").hide(300),"0"!=r.getKey("master_password"))var s=!0;else var s=!1;r.setUserKey("master_password","0"),r.setUserKey("extra_auth_type",e),a("#app-settings").attr("auth_type",e),s&&OCdialogs.info(t("passwords","The master password has been removed."),t("passwords","Master password"),function(){return!1},!0)}else a("#div_master_password").show(300)}),a("#save_masterkey").click(function(){var e=a("#new_masterkey1").val(),s=a("#new_masterkey2").val();e==s?(r.setUserKey("extra_auth_type","master"),a("#app-settings").attr("auth_type","master"),r.setUserKey("master_password",SHA512(e)),OCdialogs.info(t("passwords","The master password has been set."),t("passwords","Master password"),function(){return!1},!0),a("#new_masterkey1").val(""),a("#new_masterkey2").val(""),a("#div_master_password").hide(),a("#div_edit_master_password").show()):OCdialogs.alert(t("passwords","The new passwords do not match."),t("passwords","Master password"),function(){return!1},!0)}),"0"!=a("#app-settings").attr("timer")&&resetTimer(!1),a("#add_new").click(function(){popUp("","","new_password","","",""),a("#new_website").focusout(function(){"http://"!=this.value.substring(0,7).toLowerCase()&&"https://"!=this.value.substring(0,8).toLowerCase()&&"www."!=this.value.substring(0,4).toLowerCase()||""!=a("#new_address").val()||(a("#new_address").val(this.value.toLowerCase()),a("#new_website").val(strip_website(this.value).toLowerCase())),webimg2new()}),a("#new_address").focusout(function(){"http://"!=this.value.substring(0,7).toLowerCase()&&"https://"!=this.value.substring(0,8).toLowerCase()&&"www."!=this.value.substring(0,4).toLowerCase()||""!=a("#new_website").val()||a("#new_website").val(URLtoDomain(this.value)),webimg2new()}),a("#clear").click(function(){a("#new_username").val(""),a("#new_website").val(""),a("#new_password").val(""),a("#new_address").val(""),a("#new_notes").val(""),a("#new_category select").val(0),a("#new_category select").attr("style",""),a("#generate_strength").text(""),a("#generate_passwordtools").hide(),a("#gen_length").val("30"),webimg2new()}),a("#accept").click(function(){if(""==a("#new_username").val()||""==a("#new_website").val()||""==a("#new_password").val())return OCdialogs.alert(t("passwords","Fill in the website, user name and password."),t("passwords","Add password"),function(){return!1},!0),!1;if(""!=a("#new_address").val()&&"http://"!=a("#new_address").val().substring(0,7).toLowerCase()&&"https://"!=a("#new_address").val().substring(0,8).toLowerCase()&&"www."!=a("#new_address").val().substring(0,4).toLowerCase()){if(!isUrl(a("#new_address").val()))return OCdialogs.alert(t("passwords","Fill in a valid URL in the first field.")+" "+t("passwords","Note: This field is optional and can be left blank."),t("passwords","Add password"),function(){return!1},!0),a("#new_address").select(),!1;if(a("#new_address").val("http://"+a("#new_address").val()),!isUrl(a("#new_address").val()))return OCdialogs.alert(t("passwords","Fill in a valid URL in the first field.")+" "+t("passwords","Note: This field is optional and can be left blank."),t("passwords","Add password"),function(){return!1},!0),a("#new_address").select(),!1}var s={website:a("#new_website").val(),pass:a("#new_password").val(),loginname:a("#new_username").val(),address:a("#new_address").val(),category:a("#new_category select").val(),notes:a("#new_notes").val(),deleted:"0"};removePopup();var r=new e(generateUrl("/passwords"));r.create(s).done(function(){a("#new_username").val(""),a("#new_website").val(""),a("#new_password").val(""),a("#new_address").val(""),a("#new_notes").val(""),a("#new_category select").val(0),a("#new_category select").attr("style",""),a("#generate_strength").text(""),a("#generate_passwordtools").hide(),a("#gen_length").val("30");var t=new e(generateUrl("/passwords")),s=new i(t);t.loadAll().done(function(){s.renderContent()});var r=a("#template-passwords-serialize").html(),o=Handlebars.compile(r),n=o({passwords:t.getAll()});n=n.replace(/&quot;/g,'"');var d=n.split("<br>");formatTable(!1,d)}).fail(function(){return OCdialogs.alert(t("passwords","Error: Could not create password."),t("passwords","Add password"),function(){return!1},!0),!1})}),a("#new_category").change(function(){if("(change)"==a("#new_category select").val())a("#new_category select").val(0),a("#new_category select").attr("style",""),a("#editCategories").click();else if(0!=a("#new_category select").val()){var e=a("#new_category").find(":selected").attr("bg"),t=a("#new_category").find(":selected").attr("fg");a("#new_category select").attr("style","color: #"+t+" !important; background-color: "+e+" !important; font-weight: bold !important;")}else a("#new_category select").attr("style","")}),a("#nav_category_list").change(function(){if("(change)"==a("#nav_category_list select").val())a("#nav_category_list select").val(0),a("#nav_category_list select").attr("style",""),"active"==a("#app-settings").attr("active-table")?a("#list_active").click():a("#list_trash").click(),a("#editCategories").click();else if(0!=a("#nav_category_list select").val()){a("#list_active").click();var e=a("#nav_category_list").find(":selected").attr("bg"),t=a("#nav_category_list").find(":selected").attr("fg");a("#nav_category_list select").attr("style","color: #"+t+" !important; background-color: "+e+" !important;");var s=a("#PasswordsTableContent tr").not("thead tr").not(".is_deleted"),r=a("#nav_category_list select option:selected").text();s.show().filter(function(){var e=a(this).find(".cell_category").text();return!~e.indexOf(r)}).hide()}else a("#nav_category_list select").attr("style",""),"active"==a("#app-settings").attr("active-table")?a("#list_active").click():a("#list_trash").click()}),a("textarea").keydown(function(e){var t,s,r;return 9===e.keyCode?(r=this.selectionStart,s=this.selectionEnd,t=a(this),t.val(t.val().substring(0,r)+"	"+t.val().substring(s)),this.selectionStart=this.selectionEnd=r+1,!1):void 0}),a("#new_password").keyup(function(){strength_str(this.value,!1)}),a("#new_password").click(function(){this.select()}),a("#new_generate").click(function(){a("#generate_passwordtools").fadeIn(500),document.getElementById("generate_passwordtools").scrollIntoView({behavior:"smooth"});var e=a("#gen_lower").prop("checked"),s=a("#gen_upper").prop("checked"),r=a("#gen_numbers").prop("checked"),o=a("#gen_special").prop("checked"),n=a("#gen_length").val(),i="";return!isNumeric(n)||0==n.length||4>n?(OCdialogs.alert(t("passwords","Fill in a valid number as length with a minimum of 4."),t("passwords","Generate password"),function(){return!1},!0),!1):e||s||r||o?(i=generatepw(e,s,r,o,n),strength_str(i,!1),void a("#new_password").val(i)):(OCdialogs.alert(t("passwords","Select at least one option to generate a password."),t("passwords","Generate password"),function(){return!1},!0),!1)})}),a("#editCategories").click(function(){a("#app-settings-content").hide(200),a("#sidebarClose").click(),a("#section_table").hide(200),a("#section_categories").show(300)}),a("#trashAll").click(function(){trashAllPasswords(e)}),a("#backupDL").click(function(){backupPasswords()}),a("#upload_csv").on("change",function(e){uploadCSV(e)}),a("#importStart").click(function(){checkCSVsettings(),importCSV()}),a("#importCancel").click(function(){a("#CSVtableDIV").hide(),a("#CSVcontent").text(""),a("#CSVheadersBtn").removeClass("CSVbuttonOff"),a("#CSVquotationmarksBtn").removeClass("CSVbuttonOff"),a("#CSVescapeslashBtn").removeClass("CSVbuttonOff"),a("#CSVsplit_rnBtn").removeClass("CSVbuttonOff")}),a("#CSVheadersBtn").click(function(){a("#CSVheadersBtn").toggleClass("CSVbuttonOff"),renderCSV(!1)}),a("#CSVquotationmarksBtn").click(function(){a("#CSVquotationmarksBtn").toggleClass("CSVbuttonOff"),renderCSV(!1)}),a("#CSVescapeslashBtn").click(function(){a("#CSVescapeslashBtn").toggleClass("CSVbuttonOff"),renderCSV(!1)}),a("#CSVsplit_rnBtn").click(function(){a("#CSVsplit_rnBtn").toggleClass("CSVbuttonOff"),renderCSV(!1)}),a("#selectAll").click(function(){var e=a("#CSVtable td").find(":checkbox");e.prop("checked",!0)}),a("#selectNone").click(function(){var e=a("#CSVtable td").find(":checkbox");e.prop("checked",!1)}),a("#search_clear").click(function(){a("#search_text").val(""),a("#search_text").keyup()}),a("#search_text").keyup(function(){a("#list_active").click();var e=a("#PasswordsTableContent tr").not("thead tr").not(".is_deleted"),t=a.trim(a(this).val()).replace(/ +/g," ").toLowerCase();e.show().filter(function(){var e=a(this).text().replace(/\s+/g," ").toLowerCase();return!~e.indexOf(t)}).hide()}),a("#list_active").click(function(){a("#list_active").addClass("active"),a("#list_trash").removeClass("active"),a("#app-settings").attr("active-table","active"),a("#cleartrashbin").hide(),a("#PasswordsTableContent tbody tr").show(),a("#PasswordsTableContent tbody tr.is_deleted").hide(),formatTable(!0)}),a("#list_trash").click(function(){a("#list_active").removeClass("active"),a("#list_trash").addClass("active"),a("#app-settings").attr("active-table","trashbin"),a("#PasswordsTableContent tbody tr").hide(),a("#PasswordsTableContent tbody tr.is_deleted").show(),a(".menu_passwords_trashbin").text()>0&&a("#cleartrashbin").show(),formatTable(!0)})},render:function(){a("#loading").show(),a("#PasswordsTable").hide(),this.renderNavigation(),this.renderContent(),a("#loading").hide(),a("#PasswordsTable").show(),a("#list_active").click()}};var d=new n(generateUrl("/settings")),l=new e(generateUrl("/passwords")),c=new i(l),p=new o(generateUrl("/categories"));d.load(),"true"==d.getKey("disable_contextmenu").toLowerCase()&&this.addEventListener("contextmenu",function(e){return e.preventDefault(),OCdialogs.info(t("passwords","The context menu is disabled by your administrator."),t("passwords","Context menu"),function(){return!1},!0),!1},!1),0!=d.getKey("timer")&&this.addEventListener("mouseover",function(){"0"!=a("#app-settings").attr("timer")&&resetTimer(!0)}),p.loadAll().done(function(){renderCategories(p)}).fail(function(){OCdialogs.alert(t("passwords","Error: Could not load categories."),t("passwords","Passwords"),function(){return!1},!0)}),l.loadAll().done(function(){c.render()}).fail(function(){OCdialogs.alert(t("passwords","Error: Could not load passwords."),t("passwords","Passwords"),function(){return!1},!0)})})}(OC,window,jQuery);
